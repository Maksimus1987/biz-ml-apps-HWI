# BIZ-ML-APPS-HWI

Этот репозиторий содержит микросервисы для обработки данных и визуализации метрик в рамках выполенения Домашнего задания №1 по дисциплине "Бизнес-применение машинного обучения".

## Структура репозитория

Репозиторий состоит из следующих компонентов:
```
|   .DS_Store
|   docker-compose.yml
|   README.md
|
+---features
|   |   .DS_Store
|   |   Dockerfile
|   |   requirements.txt
|   |
|   \---src
|           .DS_Store
|           features.py
|
+---metric
|   |   .DS_Store
|   |   Dockerfile
|   |   requirements.txt
|   |
|   \---src
|           .DS_Store
|           metric.py
|
+---model
|   |   .DS_Store
|   |   Dockerfile
|   |   requirements.txt
|   |
|   \---src
|           .DS_Store
|           model.py
|           myfile.pkl
|
\---plot
        Dockerfile
        plot.py
        requirements.txt
```
## Коммиты

### Обновление metric.py

- Добавлен импорт библиотеки `pandas` для работы с DataFrame.
- Реализовано создание папки `logs` и файла `metric_log.csv` при запуске скрипта (если они не существуют) для хранения метрик.
- Созданы функции-обработчики `process_y_true` и `process_y_pred` для каждой очереди (`y_true` и `y_pred`), которые добавляют данные в DataFrame и вызывают функцию для вычисления абсолютной ошибки.
- Функция `calculate_absolute_error` теперь проверяет наличие значений `y_true` и `y_pred`, вычисляет абсолютную ошибку и записывает данные в CSV-файл.
- Улучшено сообщение об ошибке при неудачном подключении к очереди для более информативного вывода.

### Обновление features.py

- Импорт модуля `time` для использования функции `sleep`.
- Генерация уникального идентификатора с помощью `datetime.timestamp(datetime.now())` для каждого сообщения.
- Форматирование сообщений в виде словарей с ключами `id` и `body`.
- Добавлена задержка на 10 секунд между итерациями с помощью `time.sleep(10)`.

Теперь код бесконечно отправляет векторы признаков и истинные ответы в очереди RabbitMQ с уникальными идентификаторами и задержкой между отправками.

### Добавлен сервис plot для визуализации метрик

- Создан файл `plot.py`, который считывает данные из `metric_log.csv` и строит гистограмму абсолютных ошибок.
- Создан `Dockerfile` для сервиса `plot`, настроены зависимости и рабочая директория.
- Добавлен файл `requirements.txt` с необходимыми библиотеками (`pandas`, `matplotlib`).
- Обновлён `docker-compose.yml`:
  - Добавлен новый сервис `plot`, который зависит от сервиса `metric`.
  - Настроено связывание локальной директории `logs` с директорией контейнера для сохранения графиков.
- Убедился в корректной работе всех сервисов при запуске через Docker Compose.

Теперь сервис `plot` будет автоматически обновлять гистограмму абсолютных ошибок каждые 10 секунд и сохранять её в локальной директории `logs`.

## Запуск приложения

1. Убедитесь, что у вас установлен Docker и Docker Compose.
2. Перейдите в корневую директорию проекта.
3. Выполните команду:

`docker-compose up --build`
